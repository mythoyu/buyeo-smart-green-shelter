# SHDDC 컨트롤러 통신프로토콜 (AHU)

## ⚠️ 중요 사항

1. **통신 설정**: Baud Rate 38400bps, Data bit 8bit, Stop bit 1bit, Parity bit None
2. **변경사항**: 운용 중 발생하는 변경사항은 장비 제조사 또는 설치 관리자에게 문의
3. **입출력 포트**: 사용 유무는 장비 제조사에 문의
4. **Hex 주소**: hex로 어드레스 입력하는 제어기는 자료의 어드레스를 hex로 변환하여 입력
5. **주소 매핑**:
   - 1번부터 시작하는 제어기: 자료의 주소 그대로 사용
   - 0번부터 시작하는 제어기: 맵핑주소에 -1 한 주소값 사용

## 🚀 **프로그래머 빠른 참조**

### **주요 Function Code 요약**

- **01**: Read Coil Status (1x) - 읽기 전용
- **02**: Read Input Status (1x) - 읽기 전용
- **03**: Read Holding Registers (4x) - 읽기 전용
- **04**: Read Input Registers (3x) - 읽기 전용
- **05**: Write Single Coil (0x) - 쓰기 전용
- **06**: Write Single Register (4x) - 쓰기 전용

## 📋 **포트별 주소 매핑 테이블 (프로그래머용)**

### **DO(Digital Output) 제어 주소**

| 기능                     | DO1 | DO2 | DO3 | DO4 | DO5 | DO6 | DO7 | DO8 | DO9 | DO10 | DO11 | DO12 | DO13 | DO14 | DO15 | DO16 |
| ------------------------ | --- | --- | --- | --- | --- | --- | --- | --- | --- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| **Mode설정**             | 352 | 353 | 354 | 355 | 356 | 357 | 358 | 359 | 360 | 361  | 362  | 363  | 364  | 385  | 386  | 367  |
| **Operation제어**        | 368 | 369 | 370 | 371 | 372 | 373 | 374 | 375 | 376 | 377  | 378  | 379  | -    | -    | -    | 383  |
| **Status상태**           | 821 | 822 | 823 | 824 | 825 | 826 | 827 | 828 | 829 | 830  | 831  | 832  | 833  | 834  | 835  | 836  |
| **Schedule상태(미사용)** | 470 | 471 | 472 | 473 | 474 | -   | -   | -   | -   | -    | -    | -    | -    | 475  | 476  | 477  |

### **스케줄 설정 주소 (4x Registers)**

| DO       | 스케줄1-1    | 스케줄1-2       | 스케줄2-1 | 스케줄2-2 |
| -------- | ------------ | --------------- | --------- | --------- |
| **DO1**  | 42,58,74,90  | 146,151,156,161 | -         | -         |
| **DO2**  | 43,59,75,91  | 147,152,157,162 | -         | -         |
| **DO3**  | 44,60,76,92  | 148,153,158,163 | -         | -         |
| **DO4**  | 45,61,77,93  | 149,154,159,164 | -         | -         |
| **DO5**  | 46,62,78,94  | -               | -         | -         |
| **DO6**  | 47,63,79,95  | -               | -         | -         |
| **DO7**  | 48,64,80,96  | -               | -         | -         |
| **DO8**  | 49,65,81,97  | -               | -         | -         |
| **DO9**  | 50,66,82,98  | -               | -         | -         |
| **DO10** | 51,67,83,99  | -               | -         | -         |
| **DO11** | 52,68,84,100 | -               | -         | -         |
| **DO12** | 53,69,85,101 | -               | -         | -         |
| **DO13** | 54,70,86,102 | -               | -         | -         |
| **DO14** | -            | 150,155,160,165 | -         | -         |
| **DO15** | -            | 167,168,169,170 | -         | -         |
| **DO16** | -            | -               | -         | -         |

_주소 순서: 시작시, 시작분, 종료시, 종료분_

### **DI(Digital Input) 제어 주소**

| 기능                 | DI1 | DI2 | DI3 | DI4 | DI5 | DI6 | DI7 | DI8 | DI9 | DI10 | DI11 | DI12 | DI13 | DI14 | DI15 | DI16 |
| -------------------- | --- | --- | --- | --- | --- | --- | --- | --- | --- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| **기능enable여부부** | 404 | 405 | 406 | 407 | 408 | 409 | 410 | 411 | 412 | 413  | 414  | 415  | 416  | 417  | 418  | 419  |
| **접점Status상태**   | -   | -   | -   | -   | -   | -   | -   | -   | -   | -    | -    | -    | 449  | 450  | 451  | -    |

### **계절 설정 주소 (1x Registers)**

| 주소(Dec) | 명칭      | 최소(Dec) | 최대(Dec) | R/W | 비고                                                                             |
| --------- | --------- | --------- | --------- | --- | -------------------------------------------------------------------------------- |
| 327       | 계절      | 동절기(0) | 하절기(1) | R   |                                                                                  |
| 328       | 1월 선택  | 미사용(0) | 사용(1)   | R/W | 하절기 사용 월 선택, 미선택 시 동절기 사용                                       |
| 329       | 2월 선택  | 미사용(0) | 사용(1)   | R/W |                                                                                  |
| 330       | 3월 선택  | 미사용(0) | 사용(1)   | R/W |                                                                                  |
| 331       | 4월 선택  | 미사용(0) | 사용(1)   | R/W |                                                                                  |
| 332       | 5월 선택  | 미사용(0) | 사용(1)   | R/W |                                                                                  |
| 333       | 6월 선택  | 미사용(0) | 사용(1)   | R/W |                                                                                  |
| 334       | 7월 선택  | 미사용(0) | 사용(1)   | R/W |                                                                                  |
| 335       | 8월 선택  | 미사용(0) | 사용(1)   | R/W |                                                                                  |
| 336       | 9월 선택  | 미사용(0) | 사용(1)   | R/W |                                                                                  |
| 337       | 10월 선택 | 미사용(0) | 사용(1)   | R/W |                                                                                  |
| 338       | 11월 선택 | 미사용(0) | 사용(1)   | R/W |                                                                                  |
| 339       | 12월 선택 | 미사용(0) | 사용(1)   | R/W |                                                                                  |
| 340       | 1월       | 동절기(0) | 하절기(1) | R   | 월 조건 만족 접점, 선택된 달과 실제 달이 일치하면 하절기, 일치하지 않으면 동절기 |
| 341       | 2월       | 동절기(0) | 하절기(1) | R   |                                                                                  |
| 342       | 3월       | 동절기(0) | 하절기(1) | R   |                                                                                  |
| 343       | 4월       | 동절기(0) | 하절기(1) | R   |                                                                                  |
| 344       | 5월       | 동절기(0) | 하절기(1) | R   |                                                                                  |
| 345       | 6월       | 동절기(0) | 하절기(1) | R   |                                                                                  |
| 346       | 7월       | 동절기(0) | 하절기(1) | R   |                                                                                  |
| 347       | 8월       | 동절기(0) | 하절기(1) | R   |                                                                                  |
| 348       | 9월       | 동절기(0) | 하절기(1) | R   |                                                                                  |
| 349       | 10월      | 동절기(0) | 하절기(1) | R   |                                                                                  |
| 350       | 11월      | 동절기(0) | 하절기(1) | R   |                                                                                  |
| 351       | 12월      | 동절기(0) | 하절기(1) | R   |                                                                                  |

## 🔗 **Modbus 명령어 ↔ API 엔드포인트 매핑 가이드**

### **포트별설정**

#### **출력설정**

| 기능                 | 매칭 commands ACTION | 타입 | 레지스터     | DO1 | DO2 | DO3 | DO4 | DO5 | DO6 | DO7 | DO8 | DO9 | DO10 | DO11 | DO12 | DO13 | DO14 | DO15 | DO16 | min | max | 설정값예시         |
| -------------------- | -------------------- | ---- | ------------ | --- | --- | --- | --- | --- | --- | --- | --- | --- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | --- | --- | ------------------ |
| **DO Operation제어** | SET_POWER            | R/W  | 1x Registers | 368 | 369 | 370 | 371 | 372 | 373 | 374 | 375 | 376 | 377  | 378  | 379  | -    | -    | -    | 383  | 0   | 1   | 정지 : 0, 운전 : 1 |
| **DO Status취득**    | GET_POWER            | R    | 1x Registers | 821 | 822 | 823 | 824 | 825 | 826 | 827 | 828 | 829 | 830  | 831  | 832  | 833  | 834  | 835  | 836  | 0   | 1   | 정지 : 0, 운전 : 1 |

#### **모드설정**

| 기능                      | 매칭 commands ACTION | 타입 | 레지스터     | DO1 | DO2 | DO3 | DO4 | DO5 | DO6 | DO7 | DO8 | DO9 | DO10 | DO11 | DO12 | DO13 | DO14 | DO15 | DO16 | min | max | 설정값예시               |
| ------------------------- | -------------------- | ---- | ------------ | --- | --- | --- | --- | --- | --- | --- | --- | --- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | --- | --- | ------------------------ |
| **Mode(수동/스케줄)**     | SET_AUTO             | R/W  | 1x Registers | 352 | 353 | 354 | 355 | 356 | 357 | 358 | 359 | 360 | 361  | 362  | 363  | 364  | 385  | 386  | 367  | 0   | 1   | 수동모드 : 0, 스케줄 : 1 |
| **Mode(수동/스케줄)상태** | -                    | R    | 1x Registers | 475 | 476 | 477 | 478 | 479 | 480 | 481 | 482 | 483 | 484  | 485  | 486  | 487  | 488  | 489  | 490  | 0   | 1   | 수동모드 : 0, 스케줄 : 1 |

#### **스케줄설정**

| 기능                    | 매칭 commands ACTION | 타입 | 레지스터     | DO1 | DO2 | DO3 | DO4 | DO5 | DO6 | DO7 | DO8 | DO9 | DO10 | DO11 | DO12 | DO13 | DO14 | DO15 | DO16 | min | max | 설정값예시 |
| ----------------------- | -------------------- | ---- | ------------ | --- | --- | --- | --- | --- | --- | --- | --- | --- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | --- | --- | ---------- |
| **시작스케줄설정(시)**  | SET_START_TIME_1     | R/W  | 4x Registers | 42  | 43  | 44  | 45  | 46  | 47  | 48  | 49  | 50  | 51   | 52   | 53   | 54   | 150  | 167  | -    | 0   | 23  | 11시 : 11  |
| **시작스케줄설정(분)**  | SET_START_TIME_1     | R/W  | 4x Registers | 58  | 59  | 60  | 61  | 62  | 63  | 64  | 65  | 66  | 67   | 68   | 69   | 70   | 155  | 168  | -    | 0   | 59  | 13분 : 13  |
| **종료스케줄설정(시)**  | SET_END_TIME_1       | R/W  | 4x Registers | 74  | 75  | 76  | 77  | 78  | 79  | 80  | 81  | 82  | 83   | 84   | 85   | 86   | 160  | 169  | -    | 0   | 23  | 11시 : 11  |
| **종료스케줄설정(분)**  | SET_END_TIME_1       | R/W  | 4x Registers | 90  | 91  | 92  | 93  | 94  | 95  | 96  | 97  | 98  | 99   | 100  | 101  | 102  | 165  | 170  | -    | 0   | 59  | 13분 : 13  |
| **시작스케줄설정2(시)** | SET_START_TIME_2     | R/W  | 4x Registers | 146 | 147 | 148 | 149 | -   | -   | -   | -   | -   | -    | -    | -    | -    | -    | -    | -    | 0   | 23  | 11시 : 11  |
| **시작스케줄설정2(분)** | SET_START_TIME_2     | R/W  | 4x Registers | 151 | 152 | 153 | 154 | -   | -   | -   | -   | -   | -    | -    | -    | -    | -    | -    | -    | 0   | 59  | 13분 : 13  |
| **종료스케줄설정2(시)** | SET_END_TIME_2       | R/W  | 4x Registers | 156 | 157 | 158 | 159 | -   | -   | -   | -   | -   | -    | -    | -    | -    | -    | -    | -    | 0   | 23  | 11시 : 11  |
| **종료스케줄설정2(분)** | SET_END_TIME_2       | R/W  | 4x Registers | 161 | 162 | 163 | 164 | -   | -   | -   | -   | -   | -    | -    | -    | -    | -    | -    | -    | 0   | 59  | 13분 : 13  |

#### **DI(Digital Input) 설정**

| 기능               | 매칭 commands ACTION | 타입 | 레지스터     | DI1 | DI2 | DI3 | DI4 | DI5 | DI6 | DI7 | DI8 | DI9 | DI10 | DI11 | DI12 | DI13 | DI14 | DI15 | DI16 | min | max | 설정값예시           |
| ------------------ | -------------------- | ---- | ------------ | --- | --- | --- | --- | --- | --- | --- | --- | --- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | --- | --- | -------------------- |
| **기능Enable설정** | -                    | R/W  | 1x Registers | 404 | 405 | 406 | 407 | 408 | 409 | 410 | 411 | 412 | 413  | 414  | 415  | 416  | 417  | 418  | 419  | 0   | 1   | 미사용 : 0, 사용 : 1 |
| **접점Status취득** | GET_POWER            | R    | 1x Registers | -   | -   | -   | -   | -   | -   | -   | -   | -   | -    | -    | -    | 449  | 449  | 449  | -    | 0   | 1   | 정지 : 0, 운전 : 1   |

### **통신장비설정**

#### **냉난방기**

| 기능                      | 매칭 commands ACTION | 타입 | 레지스터     | address | min  | max | 설정값예시                         |
| ------------------------- | -------------------- | ---- | ------------ | ------- | ---- | --- | ---------------------------------- |
| **운전 모드 읽기**        | GET_MODE             | R    | 4x Registers | 116     | 0    | 4   | 냉방 0 제습 1 송풍 2 자동 3 난방 4 |
| **바람세기 읽기**         | GET_SPEED            | R    | 4x Registers | 117     | 1    | 4   | 약 1 중 2 강 3 자동 4              |
| **설정온도 읽기**         | GET_CONT_TEMP        | R    | 4x Registers | 118     | 160  | 300 |                                    |
| **에러코드 읽기**         | GET_CONNECTION       | R    | 4x Registers | 119     | 0    | 255 |                                    |
| **현재 온도 읽기**        | GET_CUR_TEMP         | R    | 4x Registers | 120     | -990 | 990 |                                    |
| **운전 모드 통신 쓰기**   | SET_MODE             | R/W  | 4x Registers | 122     | 0    | 4   | 냉방 0 제습 1 송풍 2 자동 3 난방 4 |
| **바람세기 통신 쓰기**    | SET_SPEED            | R/W  | 4x Registers | 123     | 1    | 4   | 약 1 중 2 강 3 자동 4              |
| **설정 온도 통신 쓰기**   | SET_CONT_TEMP        | R/W  | 4x Registers | 124     | 160  | 300 |                                    |
| **하절기 SHDDC설정온도**  | SET_CONT_TEMP        | R/W  | 4x Registers | 126     | 160  | 300 |                                    |
| **동절기 SHDDC설정온도**  | SET_CONT_TEMP        | R/W  | 4x Registers | 127     | 160  | 300 |                                    |
| **최종 SHDDC온도 전송**   | SET_CONT_TEMP        | R/W  | 4x Registers | 128     | 160  | 300 |                                    |
| **운전 모드 SHDDC설정값** | SET_MODE             | R/W  | 4x Registers | 129     | 0    | 4   | 냉방 0 제습 1 송풍 2 자동 3 난방 4 |
| **바람 세기 SHDDC설정값** | SET_SPEED            | R/W  | 4x Registers | 130     | 1    | 4   | 약 1 중 2 강 3 자동 4              |

#### **전열교환기**

| 기능                      | 매칭 commands ACTION | 타입 | 레지스터     | address | min | max | 설정값예시                     |
| ------------------------- | -------------------- | ---- | ------------ | ------- | --- | --- | ------------------------------ |
| **바람 세기 읽기**        | GET_SPEED            | R    | 4x Registers | 107     | 0   | 3   | 정지 0 약 1 중 2 강 3          |
| **운전 모드 읽기**        | GET_MODE             | R    | 4x Registers | 108     | 1   | 4   | 수동1 자동 2 바이패스 3 취침 4 |
| **필터 알람 읽기**        | GET_CONNECTION       | R    | 4x Registers | 109     | 1   | 1   |                                |
| **바람 세기 통신 쓰기**   | SET_SPEED            | R/W  | 4x Registers | 110     | 0   | 3   | 정지 0 약 1 중 2 강 3          |
| **운전 모드 통신 쓰기**   | SET_MODE             | R/W  | 4x Registers | 111     | 1   | 4   | 수동1 자동 2 바이패스 3 취침 4 |
| **바람 세기 SHDDC설정값** | SET_SPEED            | R/W  | 4x Registers | 112     | 0   | 3   | 정지 0 약 1 중 2 강 3          |
| **운전 모드 SHDDC설정값** | SET_MODE             | R/W  | 4x Registers | 113     | 1   | 4   | 수동1 자동 2 바이패스 3 취침 4 |

#### **통합센서**

| 기능                   | 매칭 commands ACTION | 타입 | 레지스터     | address | min | max   | 설정값예시 |
| ---------------------- | -------------------- | ---- | ------------ | ------- | --- | ----- | ---------- |
| **초초미세먼지 PM1.0** | GET_PM100            | R    | 4x Registers | 134     | 0   | 1000  |            |
| **초미세먼지 PM2.5**   | GET_PM25             | R    | 4x Registers | 135     | 0   | 1000  |            |
| **미세먼지PM10**       | GET_PM10             | R    | 4x Registers | 136     | 0   | 1000  |            |
| **CO2**                | GET_CO2              | R    | 4x Registers | 137     | 400 | 10000 |            |
| **유기화합물**         | GET_VOC              | R    | 4x Registers | 138     | 0   | 60000 |            |
| **온도**               | GET_TEMP             | R    | 4x Registers | 139     | -40 | 125   |            |
| **습도**               | GET_HUM              | R    | 4x Registers | 140     | 0   | 1000  |            |
| **통신이상**           | GET_ALARM            | R    | 4x Registers | 141     | 0   | 1     |            |

### **4x Registers Table (Read/Write)**

| 주소(Dec) | 명칭                 | 최소(Dec) | 최대(Dec) | R/W | 비고                        |
| --------- | -------------------- | --------- | --------- | --- | --------------------------- |
| 132       | 통합센서 온도 + 2000 | -40       | 125       | R   | 기존 온도값에 + 2000 오프셋 |
|           |                      | 1960      | 2125      |     |                             |

### **RTC 관련 변수 정의**

| 구분     | Address | 비고                                     |
| -------- | ------- | ---------------------------------------- |
| 년       | DI0890  |                                          |
| 월       | DI0891  |                                          |
| 일       | DI0892  |                                          |
| 요일     | DI0893  | 0:일, 1:월, 2:화, 3:수, 4:목, 5:금, 6:토 |
| 시       | DI0894  |                                          |
| 분       | DI0895  |                                          |
| 초       | DI0896  |                                          |
| 시간표시 | DI0897  | 0: 12시 / 1: 24시                        |
| AM/PM    | DI0898  | 1: AM / 2: PM                            |

### **RS485 통신 포트 관련**

#### **DDC 내부변수**

| 내용            | DDC 내부변수 |
| --------------- | ------------ |
| COMM#1 통신이상 | PM980        |
| COMM#2 통신이상 | PM981        |
| COMM#3 통신이상 | PM982        |
| COMM#4 통신이상 | PM983        |

#### **터치어드레스**

| 내용        | 터치어드레스 |
| ----------- | ------------ |
| COMM#1 국번 | 4x 4657      |
| COMM#2 국번 | 4x 4658      |
| COMM#3 국번 | 4x 4659      |
| COMM#4 국번 | 4x 4660      |
| COMM#1 속도 | 4x 4661      |
| COMM#2 속도 | 4x 4662      |
| COMM#3 속도 | 4x 4663      |
| COMM#4 속도 | 4x 4664      |

## 📚 **추가 참고 자료**

- **Modbus 공식 사양**: [modbus.org](https://modbus.org/)
- **SHDDC 컨트롤러 매뉴얼**: 장비 제조사 문의
- **통신 설정 가이드**: 본 문서 "통신 설정 방법" 섹션 참조
