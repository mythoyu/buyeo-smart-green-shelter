# (주)보탬 RS485 통신 프로토콜

## 문서 정보

- **최종갱신**: 2016-10-04
- **적용대상**: APC100
- **문서버전**: 1.0

---

## 1. 전송규격

| 항목 | 값 |
|------|-----|
| **통신속도** | 9600 bps (고정) |
| **전송형식** | 비동기식 (Async.) |
| **데이터형식** | 8 Data Bit |
| **Parity Check** | No Parity Check |
| **Stop Bit** | 1 Stop Bit |

---

## 2. 조회주기

- **최소주기**: 1초 (권장)

---

## 3. 기본ID

- **기본ID**: 0000

---

## 4. 패킷 구성

### 4.1 기본 패킷 구조

```
[ STX Header | ID Number | Command | ETX Flag ]
```

- **STX Header**: `[` (0x5B)
- **ID Number**: 4자리 십진수 (0000~9999)
- **Command**: 명령어 문자열
- **ETX Flag**: `]` (0x5D)

---

## 5. 명령어 정의

### 5.1 ID 변경

**패킷 구성:**
```
[ xxxx(기존) BTwID xxxx(변경) ]
```

**설명**: 장비의 ID를 변경합니다.

---

### 5.2 상태 조회

**패킷 구성:**
```
[ xxxx BTR ]
```

**설명**: 현재 상태를 조회합니다.

---

### 5.3 카운트 증가

**패킷 구성:**
```
[ xxxx BTN ]
```

**설명**: 인원 카운트를 증가시킵니다.

---

### 5.4 카운트 감소

**패킷 구성:**
```
[ xxxx BTF ]
```

**설명**: 인원 카운트를 감소시킵니다.

---

### 5.5 보턴 차단설정

**패킷 구성:**
```
[ xxxx BTZ1 ]
```

**설명**: 보턴 차단을 설정합니다.

---

### 5.6 보턴 차단해제

**패킷 구성:**
```
[ xxxx BTZ0 ]
```

**설명**: 보턴 차단을 해제합니다.

---

### 5.7 현인원 리셋

**패킷 구성:**
```
[ xxxx BTC ]
```

**설명**: 현재 인원을 리셋합니다.

---

### 5.8 IN누적 리셋

**패킷 구성:**
```
[ xxxx BTI ]
```

**설명**: IN 누적 인원을 리셋합니다.

---

### 5.9 OUT누적 리셋

**패킷 구성:**
```
[ xxxx BTD ]
```

**설명**: OUT 누적 인원을 리셋합니다.

---

### 5.10 인원제한

**패킷 구성:**
```
[ xxxx BTL xxx ]
```

**설명**: 인원 제한 값을 설정합니다.

---

### 5.11 카운트 설정

**패킷 구성:**
```
[ xxxx BTP 0 1 0 0 0 0 0 ]
```

**파라미터 설명:**

| 위치 | 파라미터 | 설명 | 값 범위 |
|------|----------|------|---------|
| 1 | ID(십진수) | 장비 ID | 0000~9999 |
| 2 | Inc설정변경 | 증가 설정 변경 | 1:설정상태, 0:비설정 상태 |
| 3 | Dec설정변경 | 감소 설정 변경 | 1:설정상태, 0:비설정 상태 |
| 4 | Rst설정변경 | 리셋 설정 변경 | 1:설정상태, 0:비설정 상태 |
| 5 | 센서검사 | 센서 검사 | 1:설정상태, 0:비설정 상태 |
| 6 | 설정인원 | 설정 인원 수 | - |
| 7 | Reserve | 예약 필드 | - |
| 8 | Reserve | 예약 필드 | - |

---

## 6. 상태 응답 패킷

### 6.1 패킷 구조

**전체 길이**: 약 43 BYTE (필드 수: 약 25개 내외)

**패킷 구성:**
```
[ aaaa BTW , cccccc , eeeeee , gggggg , i , k , m , o , q , s , t , u ]
```

### 6.2 필드 정의 (원본 문서 기준)

| 순서 | 식별코드 | 필드명 | 설명 | 값 범위 |
|------|----------|--------|--------|----------|
| 1 | `[` | STX Header | 시작 바이트 | 0x5B |
| 2-5 | `aaaa` | ID Number | 장비 ID (십진수) | 0000~9999 |
| 6-8 | `BTW` | Response | 응답 코드 | - |
| 9 | `,` | 구분자 | 콤마 | - |
| 10-15 | `cccccc` | 입실누적 | 입실 누적 인원 수 | - |
| 16 | `,` | 구분자 | 콤마 | - |
| 17-22 | `eeeeee` | 퇴실누적 | 퇴실 누적 인원 수 | - |
| 23 | `,` | 구분자 | 콤마 | - |
| 24-29 | `gggggg` | 현재인원 | 현재 인원 수 | 00000~32000 |
| 30 | `,` | 구분자 | 콤마 | - |
| 31 | `i` | 출력1 | 출력1 상태 | 0=OFF, 1=ON |
| 32 | `,` | 구분자 | 콤마 | - |
| 33 | `k` | 출력2 | 출력2 상태 | 0=OFF, 1=ON |
| 34 | `,` | 구분자 | 콤마 | - |
| 35 | `m` | 카운트설정 | 카운트 설정 상태 | - |
| 36 | `,` | 구분자 | 콤마 | - |
| 37 | `o` | 보턴 | 보턴 상태 | - |
| 38 | `,` | 구분자 | 콤마 | - |
| 39 | `q` | 센서상태 | 센서 상태 | - |
| 40 | `,` | 구분자 | 콤마 | - |
| 41 | `s` | 인원제한 | 인원 제한 상태 | 이내=0, 이상=1 |
| 42 | `,` | 구분자 | 콤마 | - |
| 43 | `t` | Reserve | 예약 필드 | - |
| 44 | `,` | 구분자 | 콤마 | - |
| 45 | `u` | Reserve | 예약 필드 | - |
| 46 | `]` | ETX Flag | 종료 바이트 | 0x5D |

---

## 7. 데이터 필드 상세 설명

### 7.1 인원 관련 데이터

- **입실누적 (cccccc)**: 입실 누적 인원 수
- **퇴실누적 (eeeeee)**: 퇴실 누적 인원 수
- **현재인원 (gggggg)**: 현재 실내 인원 수 (범위: 00000~32000)

### 7.2 출력 신호

- **출력1 (i)**: 출력1 상태 (0=OFF, 1=ON)
- **출력2 (k)**: 출력2 상태 (0=OFF, 1=ON)

### 7.3 상태 정보

- **카운트설정 (m)**: 카운트 설정 상태
- **보턴 (o)**: 보턴 상태
- **센서상태 (q)**: 센서 상태
- **인원제한 (s)**: 인원 제한 상태
  - `0`: 제한 이내
  - `1`: 제한 이상

### 7.4 예약 필드

- **Reserve (t, u)**: 예약 필드 (2개)

---

## 8. 통신 예시

### 8.1 상태 조회 요청

```
[ 0000 BTR ]
```

### 8.2 상태 응답 예시

```
[ 0000 BTW , 000030 , 000006 , 000024 , 0 , 1 , 1 , 1 , 1 , 0 , 0 , 0 ]
```

**해석:**
- ID: 0000
- 입실 누적: 30명
- 퇴실 누적: 6명
- 현재 인원: 24명
- 출력1: OFF (0)
- 출력2: ON (1)
- 카운트설정: 설정됨 (1)
- 보턴: 작동 (1)
- 센서상태: 정상 (1)
- 인원제한: 이내 (0)
- Reserve: 0
- Reserve: 0

---

## 9. 주의사항

1. **통신속도**: 9600 bps로 고정되어 있으며 변경할 수 없습니다.
2. **조회주기**: 최소 1초 간격으로 조회하는 것을 권장합니다.
3. **ID 범위**: ID는 0000~9999 범위 내에서 설정 가능합니다.
4. **현재인원 범위**: 현재 인원은 0~32000 범위를 지원합니다.
5. **패킷 구분자**: 모든 데이터 필드는 콤마(`,`)로 구분됩니다.
6. **ETX 바이트**: 패킷 종료는 `]` (0x5D) 바이트로 표시됩니다.

---

## 10. 참고사항

- 본 프로토콜은 (주)보탬의 APC100 장비에 적용됩니다.
- 프로토콜 버전: 2016-10-04 기준
- RS485 통신을 사용하며, Modbus 프로토콜과는 별개의 독립적인 프로토콜입니다.

---

**문서 작성일**: 2025-01-09
**작성자**: AI Assistant
