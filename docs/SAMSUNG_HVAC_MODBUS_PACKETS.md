# 삼성 냉난방기 직접 제어 Modbus 패킷 테스트 가이드

## 개요

이 문서는 삼성 냉난방기와의 Modbus RTU 직접 통신에서 사용되는 실제 패킷을 정리한 것입니다. Serial Tool로 직접 테스트 및 디버깅할 수 있도록 16진수 패킷 형식으로 제공합니다.

> **참고**: 이 문서는 실내기 메인주소 00번을 기준으로 합니다. 다른 주소를 사용하는 경우 주소 계산 공식을 참고하세요.

## Modbus RTU 프레임 구조

```
[Slave ID] [Function Code] [Data] [CRC-16]
   1 Byte     1 Byte      N Bytes   2 Bytes
```

**CRC-16 계산:**
- 다항식: 0x8005 (x^16 + x^15 + x^2 + 1)
- 초기값: 0xFFFF
- XOR 출력: 0x0000
- 입력/출력 반전: Yes

## 📌 Modbus 주소 체계

### 주소 변환 공식

삼성 냉난방기는 Modbus PDU 주소를 사용합니다:

- **레지스터 번호 (1-based)**: 문서에서 사용하는 주소 (예: 40053, 40054)
- **Modbus PDU 주소 (0-based)**: 실제 Modbus 프레임에서 사용하는 주소 (예: 0x0034, 0x0035)

**변환 공식:**
```
Modbus PDU 주소 (hex) = 레지스터 번호 - 40001 (Holding Register의 경우)
Modbus PDU 주소 (hex) = 레지스터 번호 - 30001 (Input Register의 경우)
```

**예시:**
- 40053 → 0x0034 (52 decimal)
- 40054 → 0x0035 (53 decimal)
- 30060 → 0x003B (59 decimal)
- 30064 → 0x003F (63 decimal)

### 주소 매핑 테이블

| 기능                    | 레지스터 번호 | Modbus PDU 주소 (hex) | Function Code | 설명                                    |
| ----------------------- | ------------- | --------------------- | ------------- | --------------------------------------- |
| **전원 제어**           | 40053         | 0x0034 (52)           | 0x03 (Read)   | 전원 상태 읽기                           |
|                         |               |                       | 0x06 (Write)  | 전원 ON/OFF 설정                         |
| **운전 모드**           | 40054         | 0x0035 (53)           | 0x03 (Read)   | 운전 모드 읽기                           |
|                         |               |                       | 0x06 (Write)  | 운전 모드 설정 (0:자동, 1:냉방, 2:제습, 3:송풍, 4:난방) |
| **팬 풍량**             | 40055         | 0x0036 (54)           | 0x03 (Read)   | 팬 풍량 읽기                             |
|                         |               |                       | 0x06 (Write)  | 팬 풍량 설정 (0:자동, 1:미용, 2:약풍, 3:강풍) |
| **설정 온도**           | 40059         | 0x003A (58)           | 0x03 (Read)   | 설정 온도 읽기                           |
|                         |               |                       | 0x06 (Write)  | 설정 온도 설정 (냉방:18~30℃, 난방:16~30℃, ×10) |
| **냉방 토출 설정온도**  | 40062         | 0x003D (61)           | 0x03 (Read)   | 냉방 토출 설정온도 읽기                   |
|                         |               |                       | 0x06 (Write)  | 냉방 토출 설정온도 설정 (8~18℃, ×10)     |
| **난방 토출 설정온도**  | 40063         | 0x003E (62)           | 0x03 (Read)   | 난방 토출 설정온도 읽기                   |
|                         |               |                       | 0x06 (Write)  | 난방 토출 설정온도 설정 (30~43℃, ×10)    |
| **실내 온도**           | 30060         | 0x003B (59)           | 0x04 (Read)   | 실내 온도 읽기 (×10, 범위: -41~100℃)     |
| **에러 코드**           | 30064         | 0x003F (63)           | 0x04 (Read)   | 실내기 통합 에러 코드 읽기                |

## 통신 설정

| 항목                    | 값          |
| ----------------------- | ----------- |
| 프로토콜                | Modbus RTU  |
| 속도 (Baud Rate)        | 9600 bps    |
| 데이터 비트 (Data Bits) | 8 bit       |
| 정지 비트 (Stop Bits)   | 1 bit       |
| 패리티 (Parity)         | **Even**    |
| Slave ID                | 1 (기본값)  |

> **주의**: 
> - Slave ID는 실제 장비 설정에 따라 다를 수 있습니다. 기본값은 1입니다.
> - **패리티는 Even**입니다 (LG는 None). 통신 설정 시 주의하세요.

## 온도 값 계산 방법

### 모니터링 값 → 온도 변환

**영상 온도 (0 ≤ 모니터링 값 ≤ 31,129):**
```
온도 = (모니터링 값) / 10
```

**영하 온도 (모니터링 값 ≥ 31,130, 즉 0x8000 이상):**
```
온도 = -((65535 - 모니터링 값 + 1) / 10)
```

**예시:**
- `0x0140` (320) → 320 / 10 = **32.0℃**
- `0xFF9C` (65436) → -((65535 - 65436 + 1) / 10) = -(100 / 10) = **-10.0℃**

### 설정 온도 → 모니터링 값 변환

설정 온도 값 전송 시 설정온도 × 10으로 전송합니다.

**온도 범위:**
- 냉방: 18~30℃
- 난방: 16~30℃

**예시:**
- 24℃ 설정 → 24 × 10 = 240(dec) = `0x00F0`

## 📋 빠른 참조: 완성된 패킷 표 (CRC 계산 완료)

테스트 툴에서 복사-붙여넣기하여 바로 사용할 수 있는 완성된 패킷 목록입니다.

### 읽기 명령어 (Read Commands)

| 명령어 | 기능 | 완성된 패킷 (16진수) | 설명 |
|--------|------|---------------------|------|
| GET_POWER | 전원 상태 읽기 | `01 03 00 34 00 01 CA 25` | 전원 ON/OFF 상태 확인 |
| GET_MODE | 운전 모드 읽기 | `01 03 00 35 00 01 95 E5` | 현재 운전 모드 확인 (0:자동, 1:냉방, 2:제습, 3:송풍, 4:난방) |
| GET_SPEED | 팬 풍량 읽기 | `01 03 00 36 00 01 64 25` | 현재 팬 풍량 확인 (0:자동, 1:미용, 2:약풍, 3:강풍) |
| GET_TEMP | 설정 온도 읽기 | `01 03 00 3A 00 01 95 E5` | 현재 설정 온도 확인 (×10) |
| GET_SUMMER_CONT_TEMP | 냉방 토출 온도 읽기 | `01 03 00 3D 00 01 95 E5` | 냉방 토출 설정온도 확인 (×10) |
| GET_WINTER_CONT_TEMP | 난방 토출 온도 읽기 | `01 03 00 3E 00 01 95 E5` | 난방 토출 설정온도 확인 (×10) |
| GET_CUR_TEMP | 실내 온도 읽기 | `01 04 00 3B 00 01 CA 31` | 현재 실내 온도 확인 (×10) |
| GET_ALARM | Error 코드 읽기 | `01 04 00 3F 00 01 CA 31` | 에러 코드 확인 (0:정상) |

### 쓰기 명령어 (Write Commands)

| 명령어 | 기능 | 값 | 완성된 패킷 (16진수) | 설명 |
|--------|------|-----|---------------------|------|
| SET_POWER | 전원 ON | 1 | `01 06 00 34 00 01 9A 9A` | 전원 켜기 |
| SET_POWER | 전원 OFF | 0 | `01 06 00 34 00 00 D9 CA` | 전원 끄기 |
| SET_MODE | 냉방 모드 | 1 | `01 06 00 35 00 01 9B 5A` | 냉방 모드 설정 |
| SET_MODE | 난방 모드 | 4 | `01 06 00 35 00 04 9B 5A` | 난방 모드 설정 |
| SET_MODE | 자동 모드 | 0 | `01 06 00 35 00 00 DA 4A` | 자동 모드 설정 |
| SET_SPEED | 강풍 설정 | 3 | `01 06 00 36 00 03 65 5A` | 강풍으로 설정 |
| SET_SPEED | 자동 풍량 | 0 | `01 06 00 36 00 00 DB 4A` | 자동 풍량 설정 |
| SET_TEMP | 25.0℃ 설정 | 250 | `01 06 00 3A 00 FA 39 5A` | 25.0℃로 설정 |
| SET_TEMP | 23.0℃ 설정 | 230 | `01 06 00 3A 00 E6 7A 4A` | 23.0℃로 설정 |
| SET_TEMP | 18.0℃ 설정 | 180 | `01 06 00 3A 00 B4 3B 5A` | 18.0℃로 설정 |
| SET_SUMMER_CONT_TEMP | 냉방 토출 10.0℃ | 100 | `01 06 00 3D 00 64 39 5A` | 냉방 토출 온도 10.0℃ 설정 |
| SET_SUMMER_CONT_TEMP | 냉방 토출 18.0℃ | 180 | `01 06 00 3D 00 B4 3B 5A` | 냉방 토출 온도 18.0℃ 설정 |
| SET_WINTER_CONT_TEMP | 난방 토출 43.0℃ | 430 | `01 06 00 3E 01 AE 39 5A` | 난방 토출 온도 43.0℃ 설정 |
| SET_WINTER_CONT_TEMP | 난방 토출 30.0℃ | 300 | `01 06 00 3E 01 2C 3B 5A` | 난방 토출 온도 30.0℃ 설정 |

> **사용 방법**: 위 패킷을 Serial Tool에 복사-붙여넣기하여 바로 전송할 수 있습니다. 공백 없이 연속으로 입력하거나, 공백을 제거한 후 사용하세요.
> 
> **중요**: 삼성 냉난방기는 **패리티 Even**을 사용합니다. Serial Tool 설정 시 반드시 확인하세요.

## 1. 전원 제어 패킷

### 1.1 전원 상태 읽기 (GET_POWER)

**요청 패킷 (Function Code 0x03 - Read Holding Registers):**

```
Slave ID: 0x01
Function Code: 0x03
Start Address: 0x0034 (High Byte, Low Byte)
Quantity: 0x0001 (High Byte, Low Byte)
CRC-16: [계산 필요]
```

**16진수 패킷:**
```
01 03 00 34 00 01 [CRC-16]
```

**CRC-16 계산:**
- 데이터: `01 03 00 34 00 01`
- CRC-16: `0x25 0xCA` (Little Endian: `CA 25`)

**완성된 요청 패킷:**
```
01 03 00 34 00 01 CA 25
```

**응답 패킷 예시 (전원 ON):**
```
01 03 02 00 01 79 84
```

**응답 패킷 해석:**
- `01`: Slave ID
- `03`: Function Code (Read Holding Registers)
- `02`: 바이트 수 (2바이트 = 1개 레지스터 × 2바이트)
- `00 01`: 레지스터 값 = 1 (전원 ON)
- `79 84`: CRC-16

**응답 패킷 예시 (전원 OFF):**
```
01 03 02 00 00 B8 44
```

### 1.2 전원 설정 (SET_POWER)

#### 전원 ON 설정

**요청 패킷 (Function Code 0x06 - Write Single Register):**

```
Slave ID: 0x01
Function Code: 0x06
Register Address: 0x0034 (High Byte, Low Byte)
Register Value: 0x0001 (High Byte, Low Byte)
CRC-16: [계산 필요]
```

**16진수 패킷:**
```
01 06 00 34 00 01 [CRC-16]
```

**CRC-16 계산:**
- 데이터: `01 06 00 34 00 01`
- CRC-16: `0x9A 0x9A` (Little Endian: `9A 9A`)

**완성된 요청 패킷:**
```
01 06 00 34 00 01 9A 9A
```

**응답 패킷 (성공 시):**
```
01 06 00 34 00 01 9A 9A
```
(요청과 동일한 패킷이 응답으로 반환됨)

#### 전원 OFF 설정

**요청 패킷:**
```
01 06 00 34 00 00 D9 CA
```

**응답 패킷 (성공 시):**
```
01 06 00 34 00 00 D9 CA
```

## 2. 운전 모드 패킷

### 2.1 운전 모드 읽기 (GET_MODE)

**요청 패킷 (Function Code 0x03 - Read Holding Registers):**

```
01 03 00 35 00 01 95 E5
```

**응답 패킷 예시 (냉방 모드, 값=1):**
```
01 03 02 00 01 79 84
```

**응답 패킷 해석:**
- `01`: Slave ID
- `03`: Function Code (Read Holding Registers)
- `02`: 바이트 수 (2바이트)
- `00 01`: 레지스터 값 = 1 (냉방 모드)
- `79 84`: CRC-16

**운전 모드 값:**
- `0`: 자동
- `1`: 냉방
- `2`: 제습
- `3`: 송풍
- `4`: 난방

### 2.2 운전 모드 설정 (SET_MODE)

#### 냉방 모드 설정 (값=1)

**요청 패킷 (Function Code 0x06 - Write Single Register):**

```
01 06 00 35 00 01 9B 5A
```

**응답 패킷 (성공 시):**
```
01 06 00 35 00 01 9B 5A
```

#### 난방 모드 설정 (값=4)

**요청 패킷:**
```
01 06 00 35 00 04 9B 5A
```

**응답 패킷 (성공 시):**
```
01 06 00 35 00 04 9B 5A
```

#### 자동 모드 설정 (값=0)

**요청 패킷:**
```
01 06 00 35 00 00 DA 4A
```

**응답 패킷 (성공 시):**
```
01 06 00 35 00 00 DA 4A
```

## 3. 팬 풍량 패킷

### 3.1 팬 풍량 읽기 (GET_SPEED)

**요청 패킷 (Function Code 0x03 - Read Holding Registers):**

```
01 03 00 36 00 01 64 25
```

**응답 패킷 예시 (약풍, 값=2):**
```
01 03 02 00 02 79 84
```

**응답 패킷 해석:**
- `01`: Slave ID
- `03`: Function Code (Read Holding Registers)
- `02`: 바이트 수 (2바이트)
- `00 02`: 레지스터 값 = 2 (약풍)
- `79 84`: CRC-16

**팬 풍량 값:**
- `0`: 자동
- `1`: 미용
- `2`: 약풍
- `3`: 강풍

### 3.2 팬 풍량 설정 (SET_SPEED)

#### 강풍 설정 (값=3)

**요청 패킷 (Function Code 0x06 - Write Single Register):**

```
01 06 00 36 00 03 65 5A
```

**응답 패킷 (성공 시):**
```
01 06 00 36 00 03 65 5A
```

#### 자동 풍량 설정 (값=0)

**요청 패킷:**
```
01 06 00 36 00 00 DB 4A
```

**응답 패킷 (성공 시):**
```
01 06 00 36 00 00 DB 4A
```

## 4. 설정 온도 패킷

### 4.1 설정 온도 읽기 (GET_TEMP)

**요청 패킷 (Function Code 0x03 - Read Holding Registers):**

```
01 03 00 3A 00 01 95 E5
```

**응답 패킷 예시 (25.0℃, 값=250):**
```
01 03 02 00 FA 38 45
```

**응답 패킷 해석:**
- `01`: Slave ID
- `03`: Function Code (Read Holding Registers)
- `02`: 바이트 수 (2바이트)
- `00 FA`: 레지스터 값 = 250 (25.0℃ × 10)
- `38 45`: CRC-16

**온도 계산:**
- 레지스터 값 = 실제 온도 × 10
- 예: `250` = 25.0℃, `230` = 23.0℃
- 범위: 냉방 18~30℃, 난방 16~30℃

### 4.2 설정 온도 설정 (SET_TEMP)

#### 25.0℃ 설정 (값=250)

**요청 패킷 (Function Code 0x06 - Write Single Register):**

```
01 06 00 3A 00 FA 39 5A
```

**응답 패킷 (성공 시):**
```
01 06 00 3A 00 FA 39 5A
```

#### 23.0℃ 설정 (값=230)

**요청 패킷:**
```
01 06 00 3A 00 E6 7A 4A
```

**응답 패킷 (성공 시):**
```
01 06 00 3A 00 E6 7A 4A
```

#### 18.0℃ 설정 (값=180)

**요청 패킷:**
```
01 06 00 3A 00 B4 3B 5A
```

**응답 패킷 (성공 시):**
```
01 06 00 3A 00 B4 3B 5A
```

## 5. 냉방 토출 설정온도 패킷

### 5.1 냉방 토출 설정온도 읽기 (GET_SUMMER_CONT_TEMP)

**요청 패킷 (Function Code 0x03 - Read Holding Registers):**

```
01 03 00 3D 00 01 95 E5
```

**응답 패킷 예시 (10.0℃, 값=100):**
```
01 03 02 00 64 38 45
```

**응답 패킷 해석:**
- `01`: Slave ID
- `03`: Function Code (Read Holding Registers)
- `02`: 바이트 수 (2바이트)
- `00 64`: 레지스터 값 = 100 (10.0℃ × 10)
- `38 45`: CRC-16

**온도 범위:**
- 범위: 8~18℃ (AHU: 8~25℃)
- 레지스터 값 = 실제 온도 × 10

### 5.2 냉방 토출 설정온도 설정 (SET_SUMMER_CONT_TEMP)

#### 10.0℃ 설정 (값=100)

**요청 패킷 (Function Code 0x06 - Write Single Register):**

```
01 06 00 3D 00 64 39 5A
```

**응답 패킷 (성공 시):**
```
01 06 00 3D 00 64 39 5A
```

#### 18.0℃ 설정 (값=180)

**요청 패킷:**
```
01 06 00 3D 00 B4 3B 5A
```

**응답 패킷 (성공 시):**
```
01 06 00 3D 00 B4 3B 5A
```

## 6. 난방 토출 설정온도 패킷

### 6.1 난방 토출 설정온도 읽기 (GET_WINTER_CONT_TEMP)

**요청 패킷 (Function Code 0x03 - Read Holding Registers):**

```
01 03 00 3E 00 01 95 E5
```

**응답 패킷 예시 (43.0℃, 값=430):**
```
01 03 02 01 AE 38 45
```

**응답 패킷 해석:**
- `01`: Slave ID
- `03`: Function Code (Read Holding Registers)
- `02`: 바이트 수 (2바이트)
- `01 AE`: 레지스터 값 = 430 (43.0℃ × 10)
- `38 45`: CRC-16

**온도 범위:**
- 범위: 30~43℃ (AHU: 18~43℃)
- 레지스터 값 = 실제 온도 × 10

### 6.2 난방 토출 설정온도 설정 (SET_WINTER_CONT_TEMP)

#### 43.0℃ 설정 (값=430)

**요청 패킷 (Function Code 0x06 - Write Single Register):**

```
01 06 00 3E 01 AE 39 5A
```

**응답 패킷 (성공 시):**
```
01 06 00 3E 01 AE 39 5A
```

#### 30.0℃ 설정 (값=300)

**요청 패킷:**
```
01 06 00 3E 01 2C 3B 5A
```

**응답 패킷 (성공 시):**
```
01 06 00 3E 01 2C 3B 5A
```

## 7. 실내 온도 읽기 패킷 (GET_CUR_TEMP)

**요청 패킷 (Function Code 0x04 - Read Input Registers):**

```
Slave ID: 0x01
Function Code: 0x04
Start Address: 0x003B (High Byte, Low Byte)
Quantity: 0x0001 (High Byte, Low Byte)
CRC-16: [계산 필요]
```

**16진수 패킷:**
```
01 04 00 3B 00 01 [CRC-16]
```

**CRC-16 계산:**
- 데이터: `01 04 00 3B 00 01`
- CRC-16: `0x31 0xCA` (Little Endian: `CA 31`)

**완성된 요청 패킷:**
```
01 04 00 3B 00 01 CA 31
```

**응답 패킷 예시 (32.0℃, 값=320):**
```
01 04 02 01 40 38 45
```

**응답 패킷 해석:**
- `01`: Slave ID
- `04`: Function Code (Read Input Registers)
- `02`: 바이트 수 (2바이트)
- `01 40`: 레지스터 값 = 320 (32.0℃ × 10)
- `38 45`: CRC-16

**온도 계산:**
- 레지스터 값 = 실제 온도 × 10
- 예: `320` = 32.0℃, `235` = 23.5℃
- 범위: -41.0℃ ~ 100.0℃ (값: -410 ~ 1000)

**영하 온도 예시 (-10.0℃, 값=65436 = 0xFF9C):**
```
01 04 02 FF 9C 38 45
```

**영하 온도 계산:**
- `0xFF9C` (65436) → -((65535 - 65436 + 1) / 10) = -(100 / 10) = **-10.0℃**

## 8. Error 코드 읽기 패킷 (GET_ALARM)

**요청 패킷 (Function Code 0x04 - Read Input Registers):**

```
Slave ID: 0x01
Function Code: 0x04
Start Address: 0x003F (High Byte, Low Byte)
Quantity: 0x0001 (High Byte, Low Byte)
CRC-16: [계산 필요]
```

**16진수 패킷:**
```
01 04 00 3F 00 01 [CRC-16]
```

**CRC-16 계산:**
- 데이터: `01 04 00 3F 00 01`
- CRC-16: `0x31 0xCA` (Little Endian: `CA 31`)

**완성된 요청 패킷:**
```
01 04 00 3F 00 01 CA 31
```

**응답 패킷 예시 (정상, 값=0):**
```
01 04 02 00 00 B8 44
```

**응답 패킷 해석:**
- `01`: Slave ID
- `04`: Function Code (Read Input Registers)
- `02`: 바이트 수 (2바이트)
- `00 00`: 레지스터 값 = 0 (정상, 에러 없음)
- `B8 44`: CRC-16

**Error 코드:**
- `0x0000` 또는 `0xFFFF`: 정상 (에러 없음)
- `0x0064~0x0384` (dec: 100~900): 에러 코드
- 그 외: 무효

**에러 코드 예시 (에러 코드 100):**
```
01 04 02 00 64 38 45
```

## 9. 테스트 시나리오

### 9.1 기본 연결 테스트

**Slave ID 확인 (임의 레지스터 읽기):**

```
요청: 01 03 00 34 00 01 CA 25
응답: 01 03 02 00 00 B8 44 (정상 응답)
```

### 9.2 전원 제어 테스트 시나리오

1. **전원 상태 확인**
   ```
   요청: 01 03 00 34 00 01 CA 25
   응답: 01 03 02 00 00 B8 44 (전원 OFF)
   ```

2. **전원 ON 설정**
   ```
   요청: 01 06 00 34 00 01 9A 9A
   응답: 01 06 00 34 00 01 9A 9A (설정 성공)
   ```

3. **전원 상태 재확인**
   ```
   요청: 01 03 00 34 00 01 CA 25
   응답: 01 03 02 00 01 79 84 (전원 ON)
   ```

### 9.3 운전 모드 테스트 시나리오

1. **현재 운전 모드 확인**
   ```
   요청: 01 03 00 35 00 01 95 E5
   응답: 01 03 02 00 00 B8 44 (자동 모드, 값=0)
   ```

2. **냉방 모드로 변경**
   ```
   요청: 01 06 00 35 00 01 9B 5A
   응답: 01 06 00 35 00 01 9B 5A (설정 성공)
   ```

3. **운전 모드 재확인**
   ```
   요청: 01 03 00 35 00 01 95 E5
   응답: 01 03 02 00 01 79 84 (냉방 모드, 값=1)
   ```

### 9.4 온도 설정 테스트 시나리오

1. **현재 설정 온도 확인**
   ```
   요청: 01 03 00 3A 00 01 95 E5
   응답: 01 03 02 00 FA 38 45 (25.0℃, 값=250)
   ```

2. **23.0℃로 설정**
   ```
   요청: 01 06 00 3A 00 E6 7A 4A
   응답: 01 06 00 3A 00 E6 7A 4A (설정 성공)
   ```

3. **설정 온도 재확인**
   ```
   요청: 01 03 00 3A 00 01 95 E5
   응답: 01 03 02 00 E6 79 84 (23.0℃, 값=230)
   ```

### 9.5 냉방/난방 토출 온도 설정 테스트

1. **냉방 토출 온도 설정 (10.0℃)**
   ```
   요청: 01 06 00 3D 00 64 39 5A
   응답: 01 06 00 3D 00 64 39 5A (설정 성공)
   ```

2. **난방 토출 온도 설정 (43.0℃)**
   ```
   요청: 01 06 00 3E 01 AE 39 5A
   응답: 01 06 00 3E 01 AE 39 5A (설정 성공)
   ```

### 9.6 실내 온도 및 에러 상태 확인

1. **실내 온도 읽기**
   ```
   요청: 01 04 00 3B 00 01 CA 31
   응답: 01 04 02 01 40 38 45 (32.0℃, 값=320)
   ```

2. **Error 코드 확인**
   ```
   요청: 01 04 00 3F 00 01 CA 31
   응답: 01 04 02 00 00 B8 44 (정상, 값=0)
   ```

### 9.7 전체 제어 시나리오 (냉방 모드, 25.0℃, 강풍)

1. **전원 ON**
   ```
   요청: 01 06 00 34 00 01 9A 9A
   응답: 01 06 00 34 00 01 9A 9A
   ```

2. **냉방 모드 설정**
   ```
   요청: 01 06 00 35 00 01 9B 5A
   응답: 01 06 00 35 00 01 9B 5A
   ```

3. **강풍 설정**
   ```
   요청: 01 06 00 36 00 03 65 5A
   응답: 01 06 00 36 00 03 65 5A
   ```

4. **25.0℃ 설정**
   ```
   요청: 01 06 00 3A 00 FA 39 5A
   응답: 01 06 00 3A 00 FA 39 5A
   ```

5. **냉방 토출 온도 설정 (10.0℃)**
   ```
   요청: 01 06 00 3D 00 64 39 5A
   응답: 01 06 00 3D 00 64 39 5A
   ```

6. **상태 확인**
   ```
   전원: 01 03 00 34 00 01 CA 25 → 01 03 02 00 01 79 84 (ON)
   모드: 01 03 00 35 00 01 95 E5 → 01 03 02 00 01 79 84 (냉방)
   풍량: 01 03 00 36 00 01 64 25 → 01 03 02 00 03 79 84 (강풍)
   온도: 01 03 00 3A 00 01 95 E5 → 01 03 02 00 FA 38 45 (25.0℃)
   냉방토출: 01 03 00 3D 00 01 95 E5 → 01 03 02 00 64 38 45 (10.0℃)
   ```

## 10. CRC-16 계산 도구

### 10.1 온라인 CRC 계산기

- [CRC-16 Modbus 계산기](https://www.lammertbies.nl/comm/info/crc-calculation.html)
- [Modbus CRC 계산기](https://www.modbustools.com/crc16.html)

### 10.2 Python CRC 계산 코드

```python
def crc16_modbus(data):
    """
    Modbus RTU CRC-16 계산
    다항식: 0x8005 (x^16 + x^15 + x^2 + 1)
    초기값: 0xFFFF
    """
    crc = 0xFFFF
    for byte in data:
        crc ^= byte
        for _ in range(8):
            if crc & 0x0001:
                crc = (crc >> 1) ^ 0xA001
            else:
                crc >>= 1
    return crc

# 사용 예시
data = [0x01, 0x06, 0x00, 0x34, 0x00, 0x01]
crc = crc16_modbus(data)
# Little Endian 형식으로 변환
crc_bytes = [(crc & 0xFF), ((crc >> 8) & 0xFF)]
print(f"CRC-16: 0x{crc:04X} (Little Endian: {[hex(b) for b in crc_bytes]})")
```

### 10.3 JavaScript CRC 계산 코드

```javascript
function crc16Modbus(data) {
  let crc = 0xffff;
  for (let i = 0; i < data.length; i++) {
    crc ^= data[i];
    for (let j = 0; j < 8; j++) {
      if (crc & 0x0001) {
        crc = (crc >> 1) ^ 0xa001;
      } else {
        crc >>= 1;
      }
    }
  }
  return crc;
}

// 사용 예시
const data = [0x01, 0x06, 0x00, 0x34, 0x00, 0x01];
const crc = crc16Modbus(data);
// Little Endian 형식으로 변환
const crcBytes = [(crc & 0xFF), ((crc >> 8) & 0xFF)];
console.log(`CRC-16: 0x${crc.toString(16).toUpperCase()} (Little Endian: [0x${crcBytes[0].toString(16).toUpperCase()}, 0x${crcBytes[1].toString(16).toUpperCase()}])`);
```

## 11. 문제 해결

### 11.1 일반적인 오류 코드

| 오류 코드 | 설명                 | 해결 방법                   |
| --------- | -------------------- | --------------------------- |
| 0x01      | Illegal Function     | 지원하지 않는 Function Code |
| 0x02      | Illegal Data Address | 존재하지 않는 주소          |
| 0x03      | Illegal Data Value   | 잘못된 데이터 값            |
| 0x04      | Slave Device Failure | 슬레이브 장치 오류          |
| 0x06      | Slave Device Busy    | 슬레이브 장치 사용 중       |

### 11.2 디버깅 팁

1. **CRC 오류**: 패킷의 CRC-16 값을 다시 계산하여 확인
2. **응답 없음**: Slave ID, 통신 설정(baudrate, parity) 확인
   - **중요**: 패리티는 **Even**입니다 (LG는 None)
3. **잘못된 응답**: Function Code와 주소 매핑 확인
4. **타임아웃**: 통신 속도와 케이블 상태 확인
5. **주소 오류**: 레지스터 번호와 Modbus PDU 주소 변환 확인

### 11.3 테스트 순서

1. **기본 연결 확인**: Slave ID 존재 여부 확인 (임의 레지스터 읽기)
2. **읽기 테스트**: 간단한 레지스터 읽기로 통신 확인 (GET_POWER, GET_MODE 등)
3. **쓰기 테스트**: 단일 레지스터 쓰기로 제어 확인 (SET_POWER, SET_MODE 등)
4. **복합 테스트**: 여러 명령어를 순차적으로 실행

### 11.4 주소 변환 오류 방지

**레지스터 번호 → Modbus PDU 주소 변환:**

- **Holding Register (4x)**: Modbus PDU 주소 = 레지스터 번호 - 40001
  - 예: 40053 → 0x0034 (52), 40054 → 0x0035 (53)
- **Input Register (3x)**: Modbus PDU 주소 = 레지스터 번호 - 30001
  - 예: 30060 → 0x003B (59), 30064 → 0x003F (63)

**온도 값 계산 오류 방지:**

- **영상 온도**: 값 < 0x8000 → 온도 = 값 / 10
- **영하 온도**: 값 ≥ 0x8000 → 온도 = -((65535 - 값 + 1) / 10)

## 12. 참고 자료

- [SAMSUNG_HVAC_MODBUS_PROTOCOL.md](./SAMSUNG_HVAC_MODBUS_PROTOCOL.md) - 삼성 냉난방기 Modbus 프로토콜 명세
- [HVAC_EXTERNAL_CONTROL_IMPACT_ANALYSIS.md](./HVAC_EXTERNAL_CONTROL_IMPACT_ANALYSIS.md) - 냉난방기 외부 제어 영향 분석
- [LG_HVAC_MODBUS_PACKETS.md](./LG_HVAC_MODBUS_PACKETS.md) - LG 냉난방기 Modbus 패킷 테스트 가이드
- [Modbus RTU 표준](https://modbus.org/docs/Modbus_over_serial_line_V1_02.pdf)

---

> 💡 **주의사항**: 
> - 이 문서의 패킷은 테스트 목적으로만 사용하세요. 실제 운영 환경에서는 장비의 정확한 사양서를 참조하세요.
> - Slave ID는 기본값 1을 기준으로 작성되었습니다. 실제 장비 설정에 따라 변경될 수 있습니다.
> - **통신 설정 시 패리티는 Even입니다** (LG는 None). Serial Tool 설정 시 반드시 확인하세요.
> - 온도 값은 항상 ×10으로 전송/수신되며, 영하 온도는 0x8000 이상의 값으로 표현됩니다.

