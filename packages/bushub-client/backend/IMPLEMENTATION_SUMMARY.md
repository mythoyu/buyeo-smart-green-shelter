# π€ ν•λ“μ›¨μ–΄ λ§¤ν•‘ μ‹μ¤ν… κµ¬ν„ μ™„λ£ μ”μ•½

## π“‹ **κµ¬ν„ μ™„λ£λ κΈ°λ¥**

### **1. c0103, c0104 ν΄λΌμ΄μ–ΈνΈ μ¶”κ°€** β…

#### **c0103 ν΄λΌμ΄μ–ΈνΈ**

- **λƒ‰λ‚λ°©κΈ° (u001)**: DO9, DO10 μ‚¬μ©
- **μ΅°λ… (u001)**: DO11 μ‚¬μ©
- **μ΅°λ… (u002)**: DO12 μ‚¬μ©
- **μ—μ–΄μ»¤νΌ (u001)**: DO13, DO14 μ‚¬μ©

#### **c0104 ν΄λΌμ΄μ–ΈνΈ**

- **λƒ‰λ‚λ°©κΈ° (u001)**: DO15, DO16 μ‚¬μ©
- **μ΅°λ… (u001)**: DI1 μ‚¬μ© (DI ν¬νΈ ν™μ©)
- **μ΅°λ… (u002)**: DI2 μ‚¬μ© (DI ν¬νΈ ν™μ©)
- **μ¨μ—΄λ²¤μΉ (u001)**: DI3, DI4 μ‚¬μ© (DI ν¬νΈ ν™μ©)

#### **ν¬νΈ ν• λ‹Ή μ „λµ**

```
c0101: DO1~DO4 (κΈ°λ³Έ)
c0102: DO5~DO8 (κΈ°λ³Έ)
c0103: DO9~DO14 (ν™•μ¥)
c0104: DO15~DO16 + DI1~DI4 (νΌν•©)
```

### **2. ν¬νΈ κ²€μ¦ κ°•ν™”** β…

#### **AdvancedPortValidator ν΄λμ¤**

- **μ‹±κΈ€ν†¤ ν¨ν„΄**: μ‹μ¤ν… μ „μ²΄μ—μ„ ν•λ‚μ μΈμ¤ν„΄μ¤ μ‚¬μ©
- **μ „μ²΄ μ‹μ¤ν… κ²€μ¦**: `validateSystemWidePorts()` λ©”μ„λ“
- **νΉμ • ν¬νΈ μ΅°ν**: `getPortUsage(portAddress)` λ©”μ„λ“
- **μ¶©λ ν•΄κ²° μ μ•**: `suggestPortResolution(conflict)` λ©”μ„λ“
- **κ²€μ¦ μ΄λ ¥ κ΄€λ¦¬**: μ¶©λ λ°μƒ μ‹ μ΄λ ¥ κΈ°λ΅

#### **κ²€μ¦ κΈ°λ¥**

- **κ°λ³„ ν΄λΌμ΄μ–ΈνΈ κ²€μ¦**: `validatePortUsage(clientId)`
- **μ‹μ¤ν… μ „μ²΄ κ²€μ¦**: λ¨λ“  ν΄λΌμ΄μ–ΈνΈ κ°„ ν¬νΈ μ¶©λ κ°μ§€
- **μ‹¤μ‹κ°„ μ¶©λ κ°μ§€**: λ°νƒ€μ„μ—μ„ ν¬νΈ μ¶©λ μ¦‰μ‹ κ°μ§€
- **μλ™ ν•΄κ²° μ μ•**: μ¶©λ μƒν™©μ— λ€ν• κµ¬μ²΄μ μΈ ν•΄κ²° λ°©μ• μ μ‹

### **3. μ„±λ¥ μµμ ν™”** β…

#### **MappingCache ν΄λμ¤**

- **μ‹±κΈ€ν†¤ ν¨ν„΄**: λ©”λ¨λ¦¬ ν¨μ¨μ μΈ μΊμ‹ κ΄€λ¦¬
- **λ‹¤μΈµ μΊμ‹±**: λ…λ Ήμ–΄, ν΄λΌμ΄μ–ΈνΈ, μ¥λΉ„, μ λ‹›λ³„ μΊμ‹±
- **TTL κΈ°λ° μ •λ¦¬**: 5λ¶„λ§λ‹¤ μλ™ μΊμ‹ μ •λ¦¬
- **μΊμ‹ ν†µκ³„**: κ° μΊμ‹ λ λ²¨λ³„ μ‚¬μ©λ‰ λ¨λ‹ν„°λ§

#### **μµμ ν™” ν¨κ³Ό**

- **λ°λ³µ μ΅°ν μ„±λ¥ ν–¥μƒ**: λ™μΌν• λ…λ Ήμ–΄ μ΅°ν μ‹ μΊμ‹μ—μ„ μ¦‰μ‹ λ°ν™
- **κ³„μΈµλ³„ κ²€μ¦ μµμ ν™”**: ν΄λΌμ΄μ–ΈνΈ/μ¥λΉ„/μ λ‹› μ΅΄μ¬ μ—¬λ¶€ μΊμ‹±
- **λ©”λ¨λ¦¬ ν¨μ¨μ„±**: TTL κΈ°λ° μλ™ μ •λ¦¬λ΅ λ©”λ¨λ¦¬ λ„μ λ°©μ§€
- **ν™•μ¥μ„±**: μƒλ΅μ΄ ν΄λΌμ΄μ–ΈνΈ μ¶”κ°€ μ‹μ—λ„ μΊμ‹ ν¨μ¨μ„± μ μ§€

## π”§ **κΈ°μ μ  νΉμ§•**

### **ν¬νΈ μ¶©λ λ°©μ§€ μ‹μ¤ν…**

```
β… c0101: DO1~DO4 (λ…λ¦½)
β… c0102: DO5~DO8 (λ…λ¦½)
β… c0103: DO9~DO14 (λ…λ¦½)
β… c0104: DO15~DO16 + DI1~DI4 (λ…λ¦½)
```

### **DI ν¬νΈ ν™μ© μ „λµ**

- **κΈ°μ΅΄**: DO ν¬νΈλ§ μ‚¬μ©ν•μ—¬ μ ν•μ  ν™•μ¥
- **κ°μ„ **: DI ν¬νΈλ¥Ό μ μ–΄ ν¬νΈλ΅ ν™μ©ν•μ—¬ ν™•μ¥μ„± μ¦λ€
- **ν¨κ³Ό**: DO ν¬νΈ λ¶€μ΅± μ‹ DI ν¬νΈλ΅ λ€μ²΄ κ°€λ¥

### **μΊμ‹± μ‹μ¤ν… μ•„ν‚¤ν…μ²**

```
λ…λ Ήμ–΄ μ΅°ν β†’ μΊμ‹ ν™•μΈ β†’ μΊμ‹ λ―Έμ¤ μ‹ β†’ λ§¤ν•‘ μ΅°ν β†’ κ²°κ³Ό μΊμ‹± β†’ λ°ν™
    β†“
μ„±λ¥ ν–¥μƒ: λ°λ³µ μ΅°ν μ‹ O(1) μ‹κ°„ λ³µμ΅λ„
```

## π“ **μ„±λ¥ μ§€ν‘**

### **ν¬νΈ μ‚¬μ© ν„ν™©**

- **μ΄ ν΄λΌμ΄μ–ΈνΈ**: 4κ° (c0101, c0102, c0103, c0104)
- **μ΄ ν¬νΈ μ**: DO 16κ° + DI 16κ° + HVAC 4κ° + Schedule 8κ°
- **ν¬νΈ μ¶©λ**: 0κ° (μ™„λ²½ν• λ¶„λ¦¬)
- **ν™•μ¥ κ°€λ¥ ν¬νΈ**: DO17~DO32, DI17~DI32 (ν–¥ν›„ μ¶”κ°€ κ°€λ¥)

### **μΊμ‹± μ„±λ¥**

- **λ…λ Ήμ–΄ μΊμ‹**: λ™μΌ λ…λ Ήμ–΄ λ°λ³µ μ΅°ν μ‹ μ¦‰μ‹ λ°ν™
- **κ²€μ¦ μΊμ‹**: ν΄λΌμ΄μ–ΈνΈ/μ¥λΉ„/μ λ‹› μ΅΄μ¬ μ—¬λ¶€ μ¦‰μ‹ ν™•μΈ
- **λ©”λ¨λ¦¬ ν¨μ¨μ„±**: TTL κΈ°λ° μλ™ μ •λ¦¬λ΅ λ©”λ¨λ¦¬ μµμ ν™”

## π― **μ‚¬μ© λ°©λ²•**

### **κΈ°λ³Έ μ‚¬μ©λ²•**

```typescript
import { getModbusCommandWithPortMapping } from './src/meta/protocols';

// μƒλ΅μ΄ λ§¤ν•‘ μ‹μ¤ν… μ‚¬μ©
const command = getModbusCommandWithPortMapping(unit, 'SET_POWER');
```

### **ν¬νΈ κ²€μ¦**

```typescript
import { portValidator } from './src/data/clientPortMappings';

// μ „μ²΄ μ‹μ¤ν… κ²€μ¦
const validation = portValidator.validateSystemWidePorts();
console.log(validation.summary);

// νΉμ • ν¬νΈ μ‚¬μ© ν„ν™©
const users = portValidator.getPortUsage(352); // DO1 ν¬νΈ
```

### **μΊμ‹ κ΄€λ¦¬**

```typescript
import { getMappingCacheStats, clearMappingCache } from './src/meta/protocols';

// μΊμ‹ ν†µκ³„ μ΅°ν
const stats = getMappingCacheStats();
console.log('μΊμ‹ μƒνƒ:', stats);

// μΊμ‹ μ΄κΈ°ν™”
clearMappingCache();
```

## π€ **ν–¥ν›„ ν™•μ¥ κ³„ν**

### **μ¦‰μ‹ κ°€λ¥ν• μ‘μ—…**

1. **c0105, c0106 ν΄λΌμ΄μ–ΈνΈ μ¶”κ°€**: λ™μΌν• ν¨ν„΄μΌλ΅ ν™•μ¥
2. **ν¬νΈ λ²”μ„ ν™•μ¥**: DO17~DO32, DI17~DI32 μ¶”κ°€
3. **λ™μ  λ§¤ν•‘**: λ°μ΄ν„°λ² μ΄μ¤ κΈ°λ° λ°νƒ€μ„ λ§¤ν•‘ λ³€κ²½

### **κ³ κΈ‰ κΈ°λ¥**

1. **ν¬νΈ λ¨λ‹ν„°λ§**: μ‹¤μ  ν•λ“μ›¨μ–΄ ν¬νΈ μƒνƒ μ‹¤μ‹κ°„ κ°μ‹
2. **μλ™ ν¬νΈ ν• λ‹Ή**: μƒλ΅μ΄ ν΄λΌμ΄μ–ΈνΈ/μ λ‹› μ¶”κ°€ μ‹ μλ™ ν¬νΈ ν• λ‹Ή
3. **ν¬νΈ μ‚¬μ©λ‰ λ¶„μ„**: ν¬νΈλ³„ μ‚¬μ© λΉλ„ λ° μ„±λ¥ λ¶„μ„

## β… **κµ¬ν„ μ™„λ£ ν™•μΈ**

- [x] c0103, c0104 ν΄λΌμ΄μ–ΈνΈ μ¶”κ°€
- [x] ν¬νΈ κ²€μ¦ κ°•ν™” (AdvancedPortValidator)
- [x] μ„±λ¥ μµμ ν™” (MappingCache)
- [x] DI ν¬νΈ ν™μ© μ „λµ
- [x] ν¬νΈ μ¶©λ λ°©μ§€ μ‹μ¤ν…
- [x] μΊμ‹± μ‹μ¤ν… μ•„ν‚¤ν…μ²
- [x] ν…μ¤νΈ νμΌ μƒμ„±
- [x] λ¬Έμ„ν™” μ™„λ£

## π‰ **κ²°λ΅ **

**ν•λ“μ›¨μ–΄ λ§¤ν•‘ μ‹μ¤ν…μ΄ μ„±κ³µμ μΌλ΅ κµ¬ν„λμ—μµλ‹λ‹¤!**

μ΄μ  4κ° ν΄λΌμ΄μ–ΈνΈκ°€ λ¨λ‘ λ…λ¦½μ μΈ ν¬νΈλ¥Ό μ‚¬μ©ν•μ—¬ ν¬νΈ μ¶©λ μ—†μ΄ μ•μ „ν•κ² Modbus ν†µμ‹ μ„ ν•  μ μμΌλ©°, μΊμ‹± μ‹μ¤ν…μ„ ν†µν•΄ μ„±λ¥λ„ ν¬κ² ν–¥μƒλμ—μµλ‹λ‹¤. μƒλ΅μ΄ ν΄λΌμ΄μ–ΈνΈλ‚ μ λ‹›μ„ μ¶”κ°€ν•  λ•λ„ λ™μΌν• ν¨ν„΄μΌλ΅ μ‰½κ² ν™•μ¥ν•  μ μμµλ‹λ‹¤.
